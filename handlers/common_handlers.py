from aiogram import Router
from aiogram.types import Message
from aiogram.filters import Command, CommandStart

from textwrap import dedent
from storage import get_user_data

router = Router()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@router.message(CommandStart())
async def cmd_start(message: Message):
    await message.reply(dedent('''
    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! üê∏
    –Ø –±—É–¥—É –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–∏ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏.
    
    –ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —á—Ç–æ —è —É–º–µ—é:
    ¬∑ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –Ω–æ—Ä–º—É –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –≤–æ–¥—ã –∏ –ø–∏—â–∏
    ¬∑ –í–µ—Å—Ç–∏ —É—á–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–Ω—ã—Ö –∫–∞–ª–æ—Ä–∏–π
    
    –í–≤–µ–¥–∏—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
    ''')
                        )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
@router.message(Command('help'))
async def cmd_help(message: Message):
    await message.reply(dedent('''
    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
    /set_profile ‚Äì –ù–∞—á–Ω–∏—Ç–µ —Ç—É—Ç ‚Äì –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    ¬∑ –ê–Ω–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ü–µ–ª—å—é —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–æ—Ä–º
    /log_water ‚Äì –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–∏—Ç–æ–π –≤–æ–¥—ã:
    ¬∑ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç, —Å–∫–æ–ª—å–∫–æ –≤–æ–¥—ã –≤—ã–ø–∏—Ç–æ
    ¬∑ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–æ—Ä–º—ã
    /log_food ‚Äì –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—ä–µ–¥–µ–Ω–Ω–æ–π –µ–¥—ã:
    ¬∑ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
    /log_workout ‚Äì –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    ¬∑ –§–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ–∂–∂—ë–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–ª–æ—Ä–∏–∏
    ¬∑ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥ –≤–æ–¥—ã –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ
    /check_progress ‚Äì –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç—á–µ—Ç:
    ¬∑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–Ω—ã—Ö –∫–∞–ª–æ—Ä–∏–π –∏ –≤–æ–¥—ã
    ¬∑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥—ã –∏ –∫–∞–ª–æ—Ä–∏–π –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –Ω–æ—Ä–º—ã
    ''')
                        )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /check_progress
@router.message(Command('check_progress'))
async def end_survey(message: Message):

    user_data = get_user_data(message.from_user.id)

    summary_message = (dedent(f'''
        üìä –ü—Ä–æ–≥—Ä–µ—Å—Å:
        –í–æ–¥–∞:
        - –í—ã–ø–∏—Ç–æ: {user_data.get('water_logged')} –º–ª –∏–∑ {user_data.get('water_goal')} –º–ª.
        - –û—Å—Ç–∞–ª–æ—Å—å: {user_data.get('water_goal') - user_data.get('water_logged')} –º–ª.
        
        –ö–∞–ª–æ—Ä–∏–∏:
        - –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–æ: {user_data.get('calories_logged')} –∫–∫–∞–ª –∏–∑ {user_data.get('calories_goal')} –∫–∫–∞–ª.
        - –°–æ–∂–∂–µ–Ω–æ: {user_data.get('calories_burned')} –∫–∫–∞–ª.
        - –ë–∞–ª–∞–Ω—Å: {user_data.get('calories_goal') + user_data.get('calories_burned') - user_data.get('calories_logged')} –∫–∫–∞–ª.
        ''')
                       )

    await message.answer(summary_message)


def setup_handlers(dp):
    dp.include_router(router)

